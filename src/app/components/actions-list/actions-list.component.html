<div class="actions-container">
  <div class="actions-header">
    <h3>Actions Management</h3>
  </div>

  <!-- Color Group Tabs -->
  @if (colorGroupsWithActions.length > 0) {
    <div class="color-tabs">
      @for (groupInfo of colorGroupsWithActions; track groupInfo.group.id) {
        <button
          class="color-tab {{ selectedColorGroupId === groupInfo.group.id ? 'active' : '' }}"
          (click)="onColorTabClick(groupInfo.group.id)"
          [style.background-color]="groupInfo.group.color"
          [style.color]="getContrastColor(groupInfo.group.color)">
          <span class="tab-emoji">{{ getColorEmoji(groupInfo.group.color) }}</span>
          <span class="tab-name">{{ groupInfo.group.name }}</span>
          <span class="tab-count">({{ groupInfo.count }})</span>
        </button>
      }
      <button
        class="color-tab manage-groups-btn"
        (click)="toggleGroupManager()"
        title="Manage Color Groups">
        <span class="tab-emoji">âš™ï¸</span>
        <span class="tab-name">Manage Groups</span>
      </button>
    </div>
  }
  
  <div class="actions-list">
    @for (action of filteredActions; track action.id) {
      <div
        class="{{ getActionClasses(action) }}"
        (click)="onActionClick(action)"
        (keydown.enter)="onActionClick(action)"
        (keydown.space)="onActionClick(action)"
        tabindex="0"
        role="button">
      
      <div class="action-color" 
           [style.background-color]="getActionColor(action)"
           [style.color]="getContrastColor(getActionColor(action))">
        â—
      </div>
      
      <div class="action-info">
        <div class="action-name">{{ action.name }}</div>
        <div class="action-mapping">{{ getMappingDisplay(action) }}</div>
      </div>
      
      <div class="action-controls">
        <button
          class="control-btn clear-btn"
          (click)="onClearMapping(action, $event)"
          [disabled]="!action.keyMappings || action.keyMappings.size === 0"
          title="Clear keybind">
          ğŸš«
        </button>
        <button 
          class="control-btn delete-btn" 
          (click)="onDeleteAction(action, $event)"
          title="Delete action">
          ğŸ—‘ï¸
        </button>
        <button 
          class="control-btn edit-btn" 
          (click)="onEditAction(action, $event)"
          title="Edit action">
          âœï¸
        </button>
      </div>
      </div>
    }

    <div class="add-action-container">
      <button class="add-action-btn" (click)="onAddAction()">
        â• Add New Action
      </button>
    </div>
  </div>
  
  <div class="instructions">
    ğŸ’¡ Instructions: Select an action above, then click a key on the keyboard to assign the mapping. Use ğŸš« to clear a keybind without removing the action. Switch between color tabs to organize your actions by type.
  </div>
</div>

<!-- Action Dialog -->
@if (showActionDialog) {
  <app-action-dialog
    [action]="editingAction"
    (save)="onDialogSave($event)"
    (cancelled)="onDialogCancel()">
  </app-action-dialog>
}

<!-- Color Groups Management Dialog -->
@if (showGroupManager) {
  <div class="dialog-overlay" (click)="closeGroupManager()" (keydown.escape)="closeGroupManager()" tabindex="-1">
    <div class="dialog-content" (click)="$event.stopPropagation()" (keydown)="$event.stopPropagation()" role="dialog" aria-modal="true" tabindex="-1">
      <div class="dialog-header">
        <h3>Manage Color Groups</h3>
        <button class="close-btn" (click)="closeGroupManager()" title="Close">âœ•</button>
      </div>
      <app-color-groups-management></app-color-groups-management>
    </div>
  </div>
}
